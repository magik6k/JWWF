<!DOCTYPE html>
<html>
	<head>
		<title>JavaWebWidgetFrmework</title>
		<meta charset="UTF-8">
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script>
			//Config
			
			var apiServer = "ws://"+document.location.host+"/wshnd";
			
			//Confing end
			
			
			var widgetStorage = [];
			var widgets = {};
			var socket;
			
			function sendButton(id){
				socket.send("B"+id);
			}
			
			function sendText(id,text){
				socket.send("T"+id+";"+text);
			}
			
			function sendSlide(id,text){
				socket.send("L"+id+";"+text);
			}
			
			function sendCheck(id, checked){
				socket.send("C"+id+";"+(checked?"1":"0"));
			}
			
			function sendSelect(id){
				socket.send("S"+id+";1");
			}
			
			
			//CUSTOM CONTROLS
			
			function CheckBox(selected){
				this.checked = false;
				
				if(selected == true)
				{
					this.checked = true;
				}
				
				this.isChecked = function(){
					return this.checked;
				}
				
				this.oncheck = function(f)
				{
					this.oncheckfn = f;
				}
				var that = this;
				this.element = $("<div>").addClass("checkbox").html(" ")
					.click(function(){
						that.checked=!that.checked;
						if(that.checked)$(that.element).html("<div class='check'>");
						else $(that.element).html(" ");
						
						if(typeof that.oncheckfn == "function")that.oncheckfn(that.checked);
					});
				
			}
			//Checkbox end
			
			var radioGroups = {}
			
			function RadioButton(group, uid){
				this.selected = false;
				
				this.isSelected = function(){
					return this.selected;
				}
				
				this.select = function(f)
				{
					this.onselectfn = f;
				}
				var that = this;
				this.element = $("<div>").addClass("radio").html(" ")
					.click(function(){
						if(radioGroups[group] == undefined)
						{
							radioGroups[group] = uid;
							that.selected = true;
						}else if(radioGroups[group] != uid){
							widgetStorage[radioGroups[group]].radio.unselect();
							radioGroups[group] = uid;
							that.selected = true;
						}
						if(that.selected)$(that.element).html("<div class='radiodot'>");
						else $(that.element).html(" ");
						
						if(that.selected&&typeof that.onselectfn == "function")that.onselectfn();
					});
				
				this.unselect = function(){
					this.selected = false;
					$(this.element).html(" ");
				}
			}
			
			//RadioButton end
			
			//WIDGET IMPLEMENTATIONS
			
			/*?WidgetImpl*/
			
			$(function(){
				socket = new WebSocket(apiServer);
				
				socket.onopen = function()
				{
					$("title").html("JavaWebWidgetFrmework - connected");
				};
				socket.onmessage = function (event) 
				{
					try{
						var data = JSON.parse(event.data);
					}catch(e){
						console.error("Error parsing data:", event.data);
					}
					console.log(data);
					
					try{
					
						if(data.id < 0)
						{
							if(data.type == "storageSet")
							{
								localStorage.setItem(data.key, data.value);
							}else if(data.type == "storageGet"){
								if(localStorage.getItem(data.key))
									socket.send("U"+data.key+";"+localStorage.getItem(data.key));
							}
						}
						else if(widgetStorage[data.id] == undefined)
						{
							widgetStorage[data.id] = widgets[data.type].create(data.data,data.id);
						}
						else
						{
							widgets[data.type].update(widgetStorage[data.id], data.data);
						}
					
					}catch(e){
						console.error("Error in logic:", e);
					}
				};
				socket.onclose = function()
				{ 
					alert("Connection closed"); 
				};
			});
		</script>
		<style>
			.checkbox{
				width: 16px;
				height: 16px;
				color: #e3e3e3;
				font-family: sans-serif;
				font-size: 24px;
				margin-top: -8px;
				-moz-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				box-shadow: inset 0 0 0 1px #a6a6a6;
				position:relative;
			}
			
			.check{
				width: 8px;
				height: 8px;
				background: #0f0f0f;
				position:relative;
				top:4px;
				left:4px;
			}
			
			.radio{
				width: 16px;
				height: 16px;
				color: #e3e3e3;
				font-family: sans-serif;
				font-size: 24px;
				-moz-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				box-shadow: inset 0 0 0 1px #a6a6a6;
				position:relative;
			}
			
			.radiodot{
				width: 8px;
				height: 8px;
				background: #0f0f0f;
				position:relative;
				top:4px;
				left:4px;
			}
			
			.tabswitch{
				cursor:pointer;
				-moz-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
			}
			
			
			.fixedPanel{position: fixed;}
			.absolutePanel{position: absolute;}
			
			/* Horizontal panel */
			.horizontal{display: flex;}
			.horizontalcontainer{flex-flow: row nowrap;display: flex;}
			.hptop{align-items: flex-start;}
			.hpmid{align-items: center;}
			.hpbot{align-items: flex-end;}
			
			
			/* Vertical panel */			
			.horizontallymiddle{display: table;margin: 0 auto;}
			.right{margin-left:auto; margin-right:0;width: min-content;width: -moz-min-content;width: -webkit-min-content;}
			.vcontainer{width: min-content;width: -moz-min-content;width: -webkit-min-content;}
			
			/*Table align*/
			.tatl{vertical-align:top;}
			.tatc{vertical-align:top;text-align:center;}
			.tatr{vertical-align:top;text-align:right;}
			.taml{}
			.tamc{text-align:center;}
			.tamr{text-align:right;}
			.tabl{vertical-align:bottom;}
			.tabc{vertical-align:bottom;text-align:center;}
			.tabr{vertical-align:bottom;text-align:right;}
			
			textarea{
				resize: none;
			}

		</style>
		<link rel="stylesheet" type="text/css" href="skins/defaultBright.css">
	</head>
	<body>
		
	</body>
</html>
